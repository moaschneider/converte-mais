<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferramenta Converter</title>
    <!-- Libre Franklin -->
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <!-- https://www.cdnfonts.com/century-gothic-paneuropean.font -->
    <link href="https://fonts.cdnfonts.com/css/century-gothic-paneuropean" rel="stylesheet">
    <!-- Roboto -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
                
    <style>
        :root {
            --largura: 90%;
            --botaoGerar: limegreen;
            --botaoVoltar: crimson;
            --botaoTabela: darkorange;
        }

        * {
            box-sizing: border-box;
            font-family: 'Roboto', 'Libre Franklin', 'Century Gothic Paneuropean', sans-serif;
        }
        pre {
            white-space: pre-wrap; /* Para preservar espaços e quebras de linha */
        }
        .margin {
            margin: 0 auto;
            width: var(--largura);
        }
        #textInput {
            width: 100%;
            height: 300px;
            border-radius: 10px;
            padding: 10px;
            font-size: 14px;
        }
        #textInputTable {
            width: var(--largura);
            height: 50px;
            border-radius: 10px;
            padding: 10px;
            font-size: 14px;
        }
        .buttons {
            display: flex;
            justify-content: space-between;
        }
        #generateButton {
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            padding: 12px;
            color: white;
            border-radius: 5px;
            outline: 0;
            background-color: var(--botaoGerar);
            border-color: var(--botaoGerar);
        }
        .textos {
            margin: 30px 0 100px 0;
            width: 100%;
            display: none;
            flex-direction: column;
            gap: 15px;
        }
        .textos__plaintext, .textos__html, .textos__preview {
            width: 100%;
            padding: 10px;
            display: flex;
            flex-direction: column;
            border: 1px solid black;
            border-radius: 10px;
        }
        .textos__plaintext h3, .textos__html h3, .textos__preview h3 {
            margin: 0;
        }
        #table-container {
            margin: 50px 0;
            display: none;
        }
        table {
            border-collapse: collapse;
        }
        td, th {
            border: 1px solid black;
            padding: 5px;
        }
        .tooltip {
        position: relative;
        display: inline-block;
        }

        .tooltip .tooltiptext {
        visibility: hidden;
        width: 60px;
        background-color: black;
        color: #fff;
        text-align: center;
        padding: 5px;
        border-radius: 5px;
        
        /* Posição da tooltip */
        position: absolute;
        z-index: 1;
        bottom: 130%;
        left: 50%;
        margin-left: -30px;
        
        /* Efeito de transição */
        opacity: 0;
        transition: opacity .8s;
        }

        .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
        }
    </style>
</head>
<body>

    <div class="margin">
        <h1>Conversor 1.2</h1>
        
        <!-- <label for="textInput">Conversão de texto</label><br> -->
        <textarea id="textInput" rows="10" cols="50" placeholder="Use (p) para separar parágrafos, ** para negrito, * para itálico, (ul) para lista não ordenada, (ol) para lista ordenada"></textarea><br><br>
        <div class="buttons">
            <div>
                <button id="copyPButton" class="tooltip">Parágrafo
                    <span class="tooltiptext">Ctrl + S</span>
                </button>
                <button id="copyUlButton" class="tooltip">UL
                    <span class="tooltiptext">Ctrl + D</span>
                </button>
                <button id="copyOlButton">OL</button>
                <button id="copyBoldButton" class="tooltip">Negrito
                    <span class="tooltiptext">Ctrl + X</span>
                </button>
                <button id="copyItalicButton" class="tooltip">Itálico</button>
                <button id="copyH4Button" class="tooltip">H4
                    <span class="tooltiptext">Ctrl + 4</span>
                </button>
                <button id="copyH5Button" class="tooltip">H5
                    <span class="tooltiptext">Ctrl + 4</span>
                </button>
                <button id="copyImgButton">Imagem</button>
                <button id="copyLoremButton">Lorem</button>
            </div>
            <button id="generateButton" onclick="generateText()">Gerar</button>
        </div>
        <br><br>
        <button id="copyTextButton">COPIAR TEXTO</button>
        <button id="copyHtmlButton">COPIAR HTML</button>
        <div class="textos">
            <div class="textos__preview">
                <div id="htmlResultado"></div>
            </div>
            <div class="textos__plaintext" style="display: none;">
                <h3>Plain Text</h3>
                <pre class="textos__plaintext__gerado"></pre>
            </div>
            <div class="textos__html">
                <h3>HTML</h3>
                <pre class="textos__html__gerado"></pre>
            </div>
        </div>
    </div>
</div>


    
    
    
    

    <script>

        function removeExcessiveSpaces(text) {
            return text.replace(/\s{3,}/g, ' ').trim();
        }

        function convertMarkdownToHtml(text) {
            // Convert markdown for bold (**) and italic (* or _)
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Negrito com **
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>'); // Itálico com *
            return text;
        }

        // Divs de plain text e HTML
        const plainTextDiv = document.querySelector('.textos__plaintext__gerado');
        const htmlDiv = document.querySelector('.textos__html__gerado');
        const htmlResultadoDiv = document.getElementById('htmlResultado');

        function removerEspacos(text){
            text = removeExcessiveSpaces(text.replace(/\n+/g, ' '));
            return text;
        }

        function divideTextoEmParagrafos(text){
            return text
                .split('(p)')
                .map(p => p.trim())
                .filter(p => p.length > 0);
        }



        let htmlOutput = '';
        let plainTextOutput = '';
        let htmlResultado = '';

        function generateText() {

            let textInput = document.getElementById('textInput').value;

            // Remove espaços excessivos e quebras de linha
            textInput = removerEspacos(textInput);

            // Divide o texto em parágrafos usando (p)
            const paragraphs = divideTextoEmParagrafos(textInput);

            htmlOutput = '';
            plainTextOutput = '';
            htmlResultado = '';

            processarParagrafos(paragraphs);

            // Mostra a div com os previews de texto e html
            document.querySelector('.textos').style.display = 'flex';


            // Remove linhas vazias extras no plain text
            plainTextOutput = plainTextOutput.trim();

            plainTextDiv.textContent = plainTextOutput;
            htmlDiv.textContent = htmlOutput;
            htmlResultadoDiv.innerHTML = htmlOutput;
        }


        // Atualiza a função processarParagrafos para usar a nova função
        function processarParagrafos(paragraphs) {
            paragraphs.forEach(paragraph => {
            // Converte hashtags em títulos ou mantém como parágrafo
            const convertedText = convertHashtagsToHtml(paragraph);


            // Detecta uma tabela e processa
            if (paragraph.startsWith('(table)') && paragraph.endsWith('(table)')) {

                // Remove os delimitadores (table) e obtém o conteúdo interno
                const tableContent = paragraph.replace(/^\(table\)|\(table\)$/g, '').trim();
                
                // Gerar o HTML da tabela
                const tableHtml = textToHtmlTable(tableContent);

                // Adicionar ao HTML final
                htmlOutput += tableHtml + '\n';

                // Adicionar o texto original no plain text
                // const tableContentChangingPipeByBreakLine = tableContent.replace(/\| /g, '\n');
                const tableContentForPlainText = tableContent.replace(/\| /g, '\n');
                const tableContentForPlainTextFinalContent =  `\nTABELA\n${tableContentForPlainText}\n\n`;
                plainTextOutput += tableContentForPlainTextFinalContent;
        } else {

            // Verifica se o parágrafo é uma lista não ordenada
            if (paragraph.startsWith('(ul)')) {
                const listItems = paragraph.split('(ul)').map(item => item.trim()).filter(item => item.length > 0);
                htmlOutput += '<ul>\n' + listItems.map(item => `<li>${convertMarkdownToHtml(item)}</li>`).join('\n') + '\n</ul>\n';
                
                // Adiciona a lista no plain text sem linhas extras
                plainTextOutput += listItems.map(item => `• ${item}`).join('\n') + '\n';
            } 
            // Verifica se o parágrafo é uma lista ordenada
            else if (paragraph.startsWith('(ol)')) {
                const listItems = paragraph.split('(ol)').map(item => item.trim()).filter(item => item.length > 0);
                htmlOutput += '<ol>\n' + listItems.map(item => `<li>${convertMarkdownToHtml(item)}</li>`).join('\n') + '\n</ol>\n';
                
                // Adiciona a lista no plain text sem linhas extras
                listItems.forEach((item, index) => {
                    plainTextOutput += `${index + 1}. ${item}\n`;
                });
            } 
            // Verifica se o parágrafo é uma imagem com figura
else if (paragraph.startsWith('(img)')) {
    const imgContent = paragraph.replace('(img)', '').trim(); // Remove o (img) e ajusta o conteúdo
    const [imgSrc, imgFigureNumber, imgFigureCaption, imgSource, imgDescription] = imgContent.split('|').map(item => item.trim()); // Separa URL, descrição, número da figura, e fonte
    
    // Constrói a estrutura de <figure> com <img> e os demais elementos
    htmlOutput += `<figure>\n`;
    
    // Parágrafo com imagem centralizada
    htmlOutput += `<p style="text-align: center;">\n`;
    htmlOutput += `<img src="https://placehold.co/500x300/crimson/black?text=${imgSrc || ''}" alt="Descrição abaixo da imagem."}">\n`;
    htmlOutput += `</p>\n`;

    // Parágrafo com número da figura e fonte
    htmlOutput += `<p style="text-align: center;">\n`;
    htmlOutput += `Figura ${imgFigureNumber || 'X'} - `;
    htmlOutput += `${imgFigureCaption || '\n'}<br>\n`;
    htmlOutput += `<sub>Fonte: ${imgSource || ''}</sub>\n`;
    htmlOutput += `</p>\n`;

    // Parágrafo com a descrição da imagem
    htmlOutput += `<p><sub>Descrição da imagem: ${imgDescription || ''}</sub></p>\n`;

    htmlOutput += `</figure>\n`;

    // Adiciona a URL da imagem no plain text (apenas URL, ou com descrição opcional)
    plainTextOutput += `Imagem: ${imgSrc}\n`;
    if (imgDescription) {
        plainTextOutput += `Descrição: ${imgDescription}\n`;
    }
    if (imgSource) {
        plainTextOutput += `Fonte: ${imgSource}\n`;
    }
} else {
                // Adiciona o texto convertido no HTML
                htmlOutput += convertedText + '\n';
    
                // Adiciona o texto original no plain text (mantendo hashtags)
                plainTextOutput += paragraph + '\n';
            }

        }
    });
}

       // Função para converter hashtags em títulos
function convertHashtagsToHtml(text) {
    // Regex para detectar títulos
    const titleRegex = /^(#{1,6})\s*(.+?)\s*#{1,6}$/;

    // Se o texto corresponder ao padrão de título, retorna a tag de título
    const match = text.match(titleRegex);
    if (match) {
        const level = match[1].length; // O número de hashtags define o nível do título
        return `<h${level}>${match[2].trim()}</h${level}>`;
    }

    // Se não for título, retorna o texto original
    return `<p>${convertMarkdownToHtml(text)}</p>`;
}


        function copyToClipboard(content) {
            const tempInput = document.createElement('textarea');
            tempInput.value = content;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
        }

        // document.getElementById('copyTextButton').addEventListener('click', () => {
        //     const textContent = document.querySelector('.textos__plaintext__gerado').textContent;
        //     copyToClipboard(textContent);
        // });

        document.getElementById('copyHtmlButton').addEventListener('click', () => {
            const htmlContent = document.querySelector('.textos__html__gerado').textContent;
            copyToClipboard(htmlContent);
        });

        // Add event listener for the new "(p)" button
        document.getElementById('copyPButton').addEventListener('click', () => {
            copyToClipboard('(p)');
        });

        // Add event listener for the new "(ul)" button
        document.getElementById('copyUlButton').addEventListener('click', () => {
            copyToClipboard('(ul)');
        });

        // Add event listener for the new "(ol)" button
        document.getElementById('copyOlButton').addEventListener('click', () => {
            copyToClipboard('(ol)');
        });

        // Add event listener for the new bold button
        document.getElementById('copyBoldButton').addEventListener('click', () => {
            copyToClipboard('**');
        });

        // Add event listener for the new italic button
        document.getElementById('copyItalicButton').addEventListener('click', () => {
            copyToClipboard('*');
        });

        // Add event listener for the new H4 button
        document.getElementById('copyH4Button').addEventListener('click', () => {
            copyToClipboard(' #### ');
        });

        // Add event listener for the new H5 button
        document.getElementById('copyH5Button').addEventListener('click', () => {
            copyToClipboard(' ##### ');
        });

        // Add event listener for the new Image button
        document.getElementById('copyImgButton').addEventListener('click', () => {
            copyToClipboard('(img)Imagem de marcação | Nº | LEGENDA DA IMAGEM | FONTE | DESCRIÇÃO DA IMAGEM');
        });

        // Add event listener for the new Lorem button
        document.getElementById('copyLoremButton').addEventListener('click', () => {
            copyToClipboard('Lorem ipsum, dolor sit amet consectetur adipisicing elit. Minus quam dolorum magni magnam, iure consequatur!');
        });


        // Função para copiar o conteúdo visível de 'htmlResultados'
        function copiarConteudoVisivel() {
            const htmlDiv = document.getElementById("htmlResultado");

            // Cria um intervalo de seleção
            const range = document.createRange();
            range.selectNodeContents(htmlDiv); // Seleciona todo o conteúdo visível da div

            // Limpa seleções anteriores
            const selection = window.getSelection();
            selection.removeAllRanges();

            // Adiciona o intervalo (o conteúdo da div) à seleção
            selection.addRange(range);

            // Executa o comando de cópia
            document.execCommand("copy");

            // Remove a seleção (opcional, para desfazer a seleção visível)
            selection.removeAllRanges();
        }

        // Evento de clique no botão para copiar
        document.getElementById("copyTextButton").addEventListener("click", copiarConteudoVisivel);








        const textarea = document.getElementById('textInput');

        // Função para inserir o texto "(p)" na posição atual do cursor
        function insertTextAtCursor(text) {
            const startPos = textarea.selectionStart;
            const endPos = textarea.selectionEnd;

            // Insere o texto na posição atual do cursor
            const beforeText = textarea.value.substring(0, startPos);
            const afterText = textarea.value.substring(endPos, textarea.value.length);
            textarea.value = beforeText + text + afterText;

            // Reposiciona o cursor após o texto inserido
            textarea.selectionStart = textarea.selectionEnd = startPos + text.length;

            // Foco de volta para a área de texto
            textarea.focus();
        }

        // Event listener para capturar Ctrl + Q
        textarea.addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key.toLowerCase() === 's') {
                event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('(p)'); // Insere o texto "(p)"
            }
            
            if (event.ctrlKey && event.key.toLowerCase() === 'd') {
                event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('(ul)'); // Insere o texto "(ul)"
            }

            if (event.ctrlKey && event.key.toLowerCase() === 'x') {
                event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('**'); // Insere o texto "**"
            }

            if (event.ctrlKey && event.key.toLowerCase() === '4') {
                event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor(' #### '); // Insere o texto " #### "
            }

            if (event.ctrlKey && event.key.toLowerCase() === '5') {
                event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor(' ##### '); // Insere o texto " ##### "
            }

        });










        // CÓDIGO DO CONVERSOR DE TABELA
        function parseCell(cell) {
            let rowspanMatch = cell.match(/\(rowspan=(\d+)\)/);
            let colspanMatch = cell.match(/\(colspan=(\d+)\)/);

            let rowspan = rowspanMatch ? parseInt(rowspanMatch[1]) : 1;
            let colspan = colspanMatch ? parseInt(colspanMatch[1]) : 1;

            cell = cell.replace(/\(rowspan=\d+\)/, "").replace(/\(colspan=\d+\)/, "").trim();

            let alignCenter = cell.startsWith(':');
            if (alignCenter) {
                cell = cell.slice(1).trim();
            }

            return { cell, rowspan, colspan, alignCenter };
        }

        function textToHtmlTable(text, columnSeparator = ";", rowSeparator = "|") {
            const rows = text.split(rowSeparator);
            let html = "<table border='1' align='center'>\n";
            let table = [];

            rows.forEach((row, rowIndex) => {
                let cells = row.split(columnSeparator);
                table[rowIndex] = table[rowIndex] || [];

                cells.forEach((cell, colIndex) => {
                    let { cell: cellContent, rowspan, colspan, alignCenter } = parseCell(cell);

                    if (rowspan > 1) {
                        for (let i = 0; i < rowspan; i++) {
                            table[rowIndex + i] = table[rowIndex + i] || [];
                            table[rowIndex + i][colIndex] = {
                                content: cellContent,
                                rowspan: rowspan,
                                colspan: colspan,
                                merged: i > 0,
                                alignCenter
                            };
                        }
                    } else {
                        if (!table[rowIndex][colIndex]) {
                            table[rowIndex][colIndex] = {
                                content: cellContent,
                                rowspan: rowspan,
                                colspan: colspan,
                                merged: false,
                                alignCenter
                            };
                        }
                    }
                });
            });

            table.forEach(row => {
                html += "  <tr>\n";
                row.forEach(cell => {
                    if (cell && !cell.merged) {
                        let style = cell.alignCenter ? ' style="text-align: center;"' : '';
                        html += `    <td${style}${cell.rowspan > 1 ? ` rowspan="${cell.rowspan}"` : ""}${cell.colspan > 1 ? ` colspan="${cell.colspan}"` : ""}>${cell.content}</td>\n`;
                    }
                });
                html += "  </tr>\n";
            });

            html += "</table>";
            return html;
        }

        function generateTable() {
            const textInputToTable = document.getElementById('textInputTable').value;
            const htmlTable = textToHtmlTable(textInputToTable);
            const tableContainer = document.getElementById('table-container__html');
            tableContainer.innerHTML = htmlTable;

            document.getElementById('table-container').style.display = 'block';

            // Mostrar os botões de copiar e adicionar
            // document.getElementById('copyButton').style.display = 'block';
            document.getElementById('addTableButton').style.display = 'block';
        }

        // // Função para adicionar a tabela gerada ao texto plain text e HTML
        // function addTableToGenerated() {
        //     const tableHtml = document.getElementById('table-container__html').innerHTML;
        //     // const textInput = document.getElementById('textInputTable').value;
            
        //     // Adicionar tabela ao HTML gerado
        //     htmlDiv.textContent += "\n" + tableHtml + "\n";

        //     // Adicionar o texto original ao plain text gerado
        //     plainTextDiv.textContent += "\n" + textInput + "\n";

        //     // Limpar a área de tabela
        //     document.getElementById('table-container').style.display = 'none';
        //     document.getElementById('addTableButton').style.display = 'none';
        // }

        // // Adiciona o evento de clique ao botão "Adicionar"
        // document.getElementById('addTableButton').addEventListener('click', addTableToGenerated);


    </script>

</body>
</html>