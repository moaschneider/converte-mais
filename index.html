<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Converte Mais 1.0</title>
    <!-- Libre Franklin -->
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <!-- Century Gothic Paneuropean -->
    <link href="https://fonts.cdnfonts.com/css/century-gothic-paneuropean" rel="stylesheet">
    <!-- Roboto -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
                
    <style>
        :root {
            --largura: 90%;
            --botaoGerar: limegreen;
            --botaoVoltar: crimson;
            --botaoTabela: darkorange;
        }
        * {
            box-sizing: border-box;
            font-family: 'Century Gothic Paneuropean', 'Roboto', 'Libre Franklin', sans-serif;
            font-size: 15px;
        }
        h1, h2, h3, h4, h5, h6 {
            font-weight: 500;
            color: #32ab53;
        }
        h1 {
            font-size: 27px;
        }
        h2 {
            font-size: 23px;
        }
        h3 {
            font-size: 21px;
        }
        h4 {
            font-size: 19px;
        }
        h5 {
            font-size: 17px;
        }
        h6 {
            font-size: 15px;
        }
        .b {
            border: 1px solid red;
        }
        pre {
            white-space: pre-wrap; /* Para preservar espaços e quebras de linha */
        }
        code {
            font-family: monospace;
            display: inline-block;
            padding: 8px;
            margin-left: 30px;
            background-color: khaki;
            border-radius: 0px;
        }
        .margin {
            margin: 0 auto;
            width: var(--largura);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 100vh;
        }
        .author {
            font-size: 14px;
            opacity: 0.8;
        }
        #textInput {
            width: 100%;
            height: 300px;
            border-radius: 10px;
            padding: 10px;
            font-size: 15px;
            border: 1px solid black;
        }
        .buttons {
            max-width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
        }
        .buttons__functions {
            max-width: 70%;
            display: flex;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 5px;
        }
        .buttons__functions button {
            padding: 4px;
            border-radius: 5px;
            border: 0.5px solid black;
        }
        .buttons__functions__tags, .buttons__functions__copy {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .buttons__functions__tags button, .buttons__functions__copy button {
            cursor: pointer;
        }
        #generateButton {
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            padding: 12px;
            color: white;
            border-radius: 5px;
            outline: 0;
            background-color: var(--botaoGerar);
            border-color: var(--botaoGerar);
        }
        #copyTextButton, #copyHtmlButton {
            background-color: black;
            color: white;
            text-transform: uppercase;
            font-weight: bold;
        }
        .textos {
            margin: 30px 0 100px 0;
            width: 100%;
            display: none;
            flex-direction: column;
            gap: 15px;
        }
        .textos__html, .textos__preview {
            width: 100%;
            padding: 10px;
            display: flex;
            flex-direction: column;
            border: 1px solid black;
            border-radius: 10px;
        }
        table {
            border-collapse: collapse;
        }
        th {
            text-align: left;
        }
        td, th {
            border: 1px solid black;
            padding: 5px;
        }
        img {
            max-width: 100%;
        }
        .tooltip {
        position: relative;
        display: inline-block;
        }

        .tooltip .tooltiptext {
        visibility: hidden;
        width: 60px;
        background-color: black;
        color: #fff;
        text-align: center;
        padding: 5px;
        border-radius: 5px;
        
        /* Posição da tooltip */
        position: absolute;
        z-index: 1;
        bottom: 130%;
        left: 50%;
        margin-left: -30px;
        
        /* Efeito de transição */
        opacity: 0;
        transition: opacity .8s;
        }
        .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
        }
    </style>
</head>
<body>

    <div class="margin">
        <div>
            <h1>Converte Mais</h1>
            
            <textarea id="textInput" rows="10" cols="50" placeholder="Use (p) para separar parágrafos, ** para negrito, * para itálico, (ul) para lista não ordenada, (ol) para lista ordenada"></textarea><br><br>
            <div class="buttons">
                <div class="buttons__functions">
                    <div class="buttons__functions__tags">
                        <button id="copyPButton" class="tooltip">Parágrafo
                            <span class="tooltiptext">Alt + S</span>
                        </button>
                        <button id="copyUlButton" class="tooltip">UL
                            <span class="tooltiptext">Alt + D</span>
                        </button>
                        <button id="copyOlButton" class="tooltip">OL
                            <span class="tooltiptext">Alt + E</span>
                        </button>
                        <button id="copyBoldButton" class="tooltip">Negrito
                            <span class="tooltiptext">Alt + X</span>
                        </button>
                        <button id="copyItalicButton" class="tooltip">Itálico
                            <span class="tooltiptext">*</span>
                        </button>
                        <button id="copyH4Button" class="tooltip">H4
                            <span class="tooltiptext">Alt + 4</span>
                        </button>
                        <button id="copyH5Button" class="tooltip">H5
                            <span class="tooltiptext">Alt + 5</span>
                        </button>
                        <button id="copyImgButton" class="tooltip">Imagem
                            <span class="tooltiptext">Alt + I</span>
                        </button>
                        <button id="copyTableButton" class="tooltip">Tabela
                            <span class="tooltiptext">Alt + B</span>
                        </button>
                        <button id="copyBlockquoteButton" class="tooltip">Blockquote
                            <span class="tooltiptext">Alt + K</span>
                        </button>
                    </div>
                    <div class="buttons__functions__copy">
                        <button id="copyTextButton">COPIAR TEXTO</button>
                        <button id="copyHtmlButton">COPIAR HTML</button>
                    </div>
                </div>
                <button id="generateButton" onclick="generateText()">Gerar</button>
            </div>
            

            <div class="textos">
                <div class="textos__preview">
                    <div id="htmlResultado"></div>
                </div>
                <div class="textos__html">
                    <h3>HTML</h3>
                    <pre id="htmlCodigo" class="textos__html__gerado"></pre>
                </div>
            </div>
        </div>
        <p class="author">Desenvolvido por Moa Schneider • Versão 1.0</p>
    </div>


    <script>
        // Variáveis que recebem os diversos processamentos ao longo do script e que vão ser inseridas nas divs
        let htmlOutput = '';
        let htmlResultado = '';

        // Nomes das divs onde entra o html código e o html resultante
        const htmlCodigoDiv = document.getElementById('htmlCodigo');
        const htmlResultadoDiv = document.getElementById('htmlResultado');

        // ::: PROCESSA BOLD E ITÁLICO :::
        function convertMarkdownToHtml(text) {
            // Convert markdown for bold (**) and italic (* or _)
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Negrito com **
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>'); // Itálico com *

            text = text.replace(/\(br\)/g, '<br>');

            text = destacarPalavras(text);

            return text;
        }

        // Destacar palavras e letras "proibidas"
        const palavrasProibidas = ['alunos', 'aluno', 'aluna', 'alunas', '\\?'];
        const unidadesMedida = ['ºC', 'kg', 'm2', 'mm', 'km', 'L', 'ml', 'm', 'g'];


        function destacarPalavras(texto) {
            palavrasProibidas.forEach(palavra => {
                // Tratar o ponto de interrogação separadamente
                if (palavra === '\\?') {
                    texto = texto.replace(/([\p{L}\w]+)\?/gu, '<span style="color: red; font-weight: bold;">$1?</span>');
                } else {
                    // Regex com bordas de palavras para outras palavras proibidas
                    const regex = new RegExp(`\\b(${palavra})\\b`, 'gi');
                    texto = texto.replace(regex, '<span style="color: red; font-weight: bold;">$1</span>');
                }
            });

            // Remove as barras invertidas que escapam os pontos de interrogação
            texto = texto.replace(/\\\?/g, '?');

            // Destacar números sem espaço antes das unidades de medida
            unidadesMedida.forEach(unidade => {
                const regex = new RegExp(`(\\d+)(${unidade})`, 'g'); // detecta números seguidos diretamente pela unidade
                texto = texto.replace(regex, '<span style="color: red; font-weight: bold;">$1$2</span>');
            });
            return texto;    
        }

        // ::: 1 - RECEBE O TEXTO, REMOVE ESPAÇOS E QUEBRAS EXCESSIVAS E PROCESSA PARÁGRAFOS :::
        function generateText() {
            

            let textInput = document.getElementById('textInput').value;

            textInput = textInput
                .replace(/\n+/g, ' ') // Remove quebras de linha
                .replace(/\s{3,}/g, ' ') // Remove espaços excessivos
                .trim(); // Remove espaços no início e no final
            
            // Divide o texto em parágrafos usando (p)
            const paragraphs = textInput.split('(p)').map(p => p.trim()).filter(p => p.length > 0);

            
            // Variáveis que recebem os diversos processamentos ao longo do script e que vão ser inseridas nas divs
            htmlOutput = '';
            htmlResultado = '';
            
            processarParagrafos(paragraphs);

            // Mostra a div com os previews de texto e html
            document.querySelector('.textos').style.display = 'flex';

            htmlCodigoDiv.textContent = htmlOutput;
            htmlResultadoDiv.innerHTML = htmlOutput;
        }


        // ::: 2 - PROCESSA OS PARÁGRAFOS ::: 
        function processarParagrafos(paragraphs) {
            let photoNumber = 1;
            paragraphs.forEach(paragraph => {

            // Se for uma tag <pre>, pula a remoção de espaços
            if (paragraph.startsWith('(pre)')) {
                const preContent = paragraph.replace('(pre)', ''); // Remove (pre) sem remover espaços
                
                // Simula o <pre> usando div com white-space
                    htmlOutput += `<div style="white-space: pre-wrap;">${convertMarkdownToHtml(preContent)}</div>\n\n`;
                    
                } else {
                    // Para outros tipos de parágrafo, primeiro remove espaços e processa normalmente
                    paragraph.replace(/\n+/g, ' ')  // Substitui quebras de linha por um espaço
                        .replace(/\s{3,}/g, ' ')    // Remove espaços consecutivos (3 ou mais)
                        .trim();                    // Remove espaços no início e no final da string

                    // Converte hashtags em títulos ou mantém como parágrafo
                    const convertedText = convertHashtagsToHtml(paragraph);    
                    
                    // Detecta uma tabela e processa
                    if (paragraph.startsWith('(table)') && paragraph.endsWith('(table)')) {
                        
                        const tableContent = paragraph.replace(/^\(table\)|\(table\)$/g, '').trim();
                        const tableHtml = textToHtmlTable(tableContent);
                        
                        htmlOutput += tableHtml + '\n\n';
                        

                    } else if (paragraph.startsWith('(block)')) {
                        // Remove o marcador (block) sem remover espaços
                        const blockquoteContent = paragraph.replace('(block)', '').trim();
                        
                        // Envolve o conteúdo com a tag <blockquote>
                        htmlOutput += `<blockquote>\n\n${blockquoteContent}`;

                    } else if (paragraph.startsWith('(/block)')) {
                        // Remove o marcador (/block) sem remover espaços
                        const blockquoteContent = paragraph.replace('(/block)', '').trim();
                        
                        // Envolve o conteúdo com a tag <blockquote>
                        htmlOutput += `${blockquoteContent}</blockquote>\n\n`;

                    } else if (paragraph.startsWith('(code)')) {
                        // Remove o marcador (code) sem remover espaços
                        const blockquoteContent = paragraph.replace('(code)', '').trim();
                        
                        // Envolve o conteúdo com a tag <code>
                        htmlOutput += `<code>${blockquoteContent}</code><br>\n\n`;

                    } else if (paragraph.startsWith('(linha)')) {
                        // Remove o marcador (linha) sem remover espaços
                        const hrContent = paragraph.replace('(linha)', '').trim();
                        
                        // Insere a tag <hr>
                        htmlOutput += `<hr>\n\n`;

                    } else if (paragraph.startsWith('(ul)')) {
                        const listItems = paragraph.split('(ul)').map(item => item.trim()).filter(item => item.length > 0);
                        htmlOutput += '<ul>\n' + listItems.map(item => `\t<li>${convertMarkdownToHtml(item)}</li>`).join('\n') + '\n</ul>\n\n';

                    } else if (paragraph.startsWith('(ol)')) {
                        const listItems = paragraph.split('(ol)').map(item => item.trim()).filter(item => item.length > 0);
                        htmlOutput += '<ol>\n' + listItems.map(item => `\t<li>${convertMarkdownToHtml(item)}</li>`).join('\n') + '\n</ol>\n\n';

                    } else if (paragraph.startsWith('(img)')) {
                        // Processa figure e insere imagem de marcação
                        const imgContent = paragraph.replace('(img)', '').trim();

                        const autoFigureNumber = photoNumber++;

                        const [imgFigureCaption, imgSource, imgDescription] = imgContent.split('|').map(item => item.trim());

                        // Palavras proibidas em legenda e descrição de fotos
                        const imgFigureCaptionDestacado = destacarPalavras(imgFigureCaption);
                        const imgDescriptionDestacado = destacarPalavras(imgDescription);

                        htmlOutput += `<figure>\n`;
                        htmlOutput += `\t<p style="text-align: center;">\n\t\t<img src="https://placehold.co/500x300/32ab53/black?text=${imgFigureCaption || ''}" alt="Descrição abaixo da imagem.">\n\t</p>\n`;
                        htmlOutput += `\t<p style="text-align: center;">Figura ${autoFigureNumber} - ${imgFigureCaptionDestacado || '\n'}<br>\n\t\t<sub>Fonte: ${imgSource || ''}</sub>\n\t</p>\n`;
                        htmlOutput += `\t<p>\n\t\t<sub>Descrição da imagem: ${imgDescriptionDestacado || ''}</sub>\n\t</p>\n`;
                        htmlOutput += `</figure>\n\n`;
                        htmlOutput += `<p><br></p>\n\n`;

                    } else {

                        // Adiciona o texto convertido no HTML
                        htmlOutput += convertedText + '\n\n';
                    }
                }
            });
        }

        // ::: 3 - CONVERSÃO DE # EM TÍTULOS :::
        function convertHashtagsToHtml(text) {
            // Regex para detectar títulos
            const titleRegex = /^(#{1,6})\s*(.+?)\s*#{1,6}$/;
            
            // Se o texto corresponder ao padrão de título, retorna a tag de título
            const match = text.match(titleRegex);
            if (match) {
                const level = match[1].length; // O número de hashtags define o nível do título
                return `<p><br></p>\n\n<h${level}>${match[2].trim()}</h${level}>`;
            }

            // Se não for título, retorna o texto original
            return `<p>${convertMarkdownToHtml(text)}</p>`;
        }


        // ::: COPIAR PARA ÁREA DE TRANSFERÊNCIA :::
        function copyToClipboard(content) {
            const tempInput = document.createElement('textarea');
            tempInput.value = content;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
        }


        // ::: COPIA TAGS DOS BOTÕES :::
        document.getElementById('copyHtmlButton').addEventListener('click', () => {
            const htmlContent = document.querySelector('#htmlCodigo').textContent;
            copyToClipboard(htmlContent);
        });

        // Add event listener for the new "(p)" button
        document.getElementById('copyPButton').addEventListener('click', () => {
            copyToClipboard('(p)');
        });

        // Add event listener for the new "(ul)" button
        document.getElementById('copyUlButton').addEventListener('click', () => {
            copyToClipboard('(ul)');
        });

        // Add event listener for the new "(ol)" button
        document.getElementById('copyOlButton').addEventListener('click', () => {
            copyToClipboard('(ol)');
        });

        // Add event listener for the new bold button
        document.getElementById('copyBoldButton').addEventListener('click', () => {
            copyToClipboard('**');
        });

        // Add event listener for the new italic button
        document.getElementById('copyItalicButton').addEventListener('click', () => {
            copyToClipboard('*');
        });

        // Add event listener for the new H4 button
        document.getElementById('copyH4Button').addEventListener('click', () => {
            copyToClipboard(' #### ');
        });

        // Add event listener for the new H5 button
        document.getElementById('copyH5Button').addEventListener('click', () => {
            copyToClipboard(' ##### ');
        });

        // Add event listener for the new Image button
        document.getElementById('copyImgButton').addEventListener('click', () => {
            copyToClipboard('\n(p) (img) LEGENDA | FONTE | DESCRIÇÃO (p)\n');
        });

        // Add event listener for the new Table button
        document.getElementById('copyTableButton').addEventListener('click', () => {
            copyToClipboard('(p)(table)\n\n(table)(p)\n');
        });

        // Event Listener para o botão Exemplo
        document.getElementById('copyBlockquoteButton').addEventListener('click', () => {
            copyToClipboard('(block)(p)\n\n(p)(/block)\n\n');
        });


        // ::: COPIAR CÓDIGOS, TEXTOS E TECLAS DE ATALHO :::
        function copiarConteudoVisivel() {
            const htmlDiv = document.getElementById("htmlResultado");

            // Cria um intervalo de seleção
            const range = document.createRange();
            range.selectNodeContents(htmlDiv); // Seleciona todo o conteúdo visível da div

            // Limpa seleções anteriores
            const selection = window.getSelection();
            selection.removeAllRanges();

            // Adiciona o intervalo (o conteúdo da div) à seleção
            selection.addRange(range);

            // Executa o comando de cópia
            document.execCommand("copy");

            // Remove a seleção (opcional, para desfazer a seleção visível)
            selection.removeAllRanges();
        }

        // Evento de clique no botão para copiar
        document.getElementById("copyTextButton").addEventListener("click", copiarConteudoVisivel);

        const textarea = document.getElementById('textInput');

        // Função para inserir o texto "(p)" na posição atual do cursor
        function insertTextAtCursor(text) {
            const startPos = textarea.selectionStart;
            const endPos = textarea.selectionEnd;

            // Insere o texto na posição atual do cursor
            const beforeText = textarea.value.substring(0, startPos);
            const afterText = textarea.value.substring(endPos, textarea.value.length);
            textarea.value = beforeText + text + afterText;

            // Reposiciona o cursor após o texto inserido
            textarea.selectionStart = textarea.selectionEnd = startPos + text.length;

            // Foco de volta para a área de texto
            textarea.focus();
        }

        // Definições das teclas de atalho
        textarea.addEventListener('keydown', function(event) {
            
            if (event.altKey && event.ctrlKey && event.key.toLowerCase() === 's') {
                // event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('(p)\n'); // Insere o texto "(p)"
            } else if (event.altKey && event.key.toLowerCase() === 's') {
                // event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('(p)'); // Insere o texto "(p)"
            }
            
            
            if (event.altKey && event.key.toLowerCase() === 'd') {
                event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('(ul)'); // Insere o texto "(ul)"
            }
            
            if (event.altKey && event.key.toLowerCase() === 'e') {
                event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('(ol)'); // Insere o texto "(ol)"
            }
            
            if (event.altKey && event.key.toLowerCase() === 'c') {
                event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('(code)'); // Insere o texto "(code)"
            }
            
            if (event.altKey && event.key.toLowerCase() === 'q') {
                event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('(br)'); // Insere o texto "(br)"
            }
            
            if (event.altKey && event.key.toLowerCase() === 'l') {
                event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('(linha)'); // Insere o texto "(linha)"
            }

            if (event.altKey && event.key.toLowerCase() === 'x') {
                // event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('**'); // Insere o texto "**"
            }

            if (event.altKey && event.key.toLowerCase() === '1') {
                // event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor(' # '); // Insere o texto " #### "
            }

            if (event.altKey && event.key.toLowerCase() === '2') {
                // event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor(' ## '); // Insere o texto " #### "
            }

            if (event.altKey && event.key.toLowerCase() === '3') {
                // event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor(' ### '); // Insere o texto " #### "
            }

            if (event.altKey && event.key.toLowerCase() === '4') {
                // event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor(' #### '); // Insere o texto " #### "
            }

            if (event.altKey && event.key.toLowerCase() === '5') {
                // event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor(' ##### '); // Insere o texto " ##### "
            }

            if (event.altKey && event.key.toLowerCase() === '6') {
                // event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor(' ###### '); // Insere o texto " ##### "
            }

            if (event.altKey && event.key.toLowerCase() === 'i') {
                // event.preventDefault(); // Evita o comportamento padrão
                insertTextAtCursor('\n(p) (img) LEGENDA | FONTE | DESCRIÇÃO (p)\n'); // Insere imagem
            }

            if (event.altKey && event.key === 'b') {
                event.preventDefault(); // Evita o comportamento padrão
                
                // Pega a posição de início e fim da seleção de texto
                let start = textarea.selectionStart;
                let end = textarea.selectionEnd;
                
                // O texto selecionado
                let selectedText = textarea.value.substring(start, end);
                
                // Adiciona os marcadores (p)(table) antes e depois da seleção
                let before = '\n(p)(table)\n\n';
                let after = '\n\n(table)(p)\n';
                let newText = before + selectedText + after;
                
                // Atualiza o conteúdo do textarea com os marcadores
                textarea.setRangeText(newText, start, end, 'end');
            }

            if (event.altKey && event.key === 'k') {
                event.preventDefault(); // Evita o comportamento padrão
                
                // Pega a posição de início e fim da seleção de texto
                let start = textarea.selectionStart;
                let end = textarea.selectionEnd;
                
                // O texto selecionado
                let selectedText = textarea.value.substring(start, end);
                
                // Adiciona os marcadores (p)(table) antes e depois da seleção
                let before = '\n(p)(block)(p)\n\n';
                let after = '\n\n(p)(/block)(p)\n';
                let newText = before + selectedText + after;
                
                // Atualiza o conteúdo do textarea com os marcadores
                textarea.setRangeText(newText, start, end, 'end');
            }            
        });


        // ::: FUNÇÃO PARA SALVAR O TRABALHO NO LOCAL STORAGE :::
        function salvarTexto() {
            const text = textarea.value;
            localStorage.setItem('textoSalvo', text);
        }

        // Carregar o texto salvo ao abrir a página
        function carregarTexto() {
            const textoSalvo = localStorage.getItem('textoSalvo');
            if (textoSalvo) {
                textarea.value = textoSalvo;
            }
        }

        // Configurar o auto-salvamento a cada 5 segundos
        setInterval(salvarTexto, 5000);

        window.addEventListener('load', carregarTexto);


        // ::: PROCESSA TABELA :::
        function parseCell(cell) {
            let rowspanMatch = cell.match(/\(rowspan=(\d+)\)/);
            let colspanMatch = cell.match(/\(colspan=(\d+)\)/);
            let thMatch = cell.match(/\(th\)/);

            let rowspan = rowspanMatch ? parseInt(rowspanMatch[1]) : 1;
            let colspan = colspanMatch ? parseInt(colspanMatch[1]) : 1;
            let isHeader = thMatch ? true : false;

            cell = cell
                .replace(/\(rowspan=\d+\)/, "")
                .replace(/\(colspan=\d+\)/, "")
                .replace(/\(th\)/, "")
                .trim();

            let alignCenter = cell.startsWith(':');
            if (alignCenter) {
                cell = cell.slice(1).trim();
            }

            return { cell, rowspan, colspan, alignCenter, isHeader };
        }

        function textToHtmlTable(text, columnSeparator = ";", rowSeparator = ";;") {
            // Substitui "\;" por valores temporários que não interferem na separação
            text = text.replace(/\\;/g, "__ESCAPED_SEMICOLON__");

            const rows = text.split(rowSeparator).map(row => row.trim());
            let html = "<table border='1' align='center'>\n";
            let table = [];

            rows.forEach((row, rowIndex) => {
                let cells = row.split(columnSeparator).map(cell => cell.trim());
                table[rowIndex] = table[rowIndex] || [];

                cells.forEach((cell, colIndex) => {
                    let { cell: cellContent, rowspan, colspan, alignCenter, isHeader } = parseCell(cell);

                    if (rowspan > 1) {
                        for (let i = 0; i < rowspan; i++) {
                            table[rowIndex + i] = table[rowIndex + i] || [];
                            table[rowIndex + i][colIndex] = {
                                content: cellContent,
                                rowspan: rowspan,
                                colspan: colspan,
                                merged: i > 0,
                                alignCenter,
                                isHeader
                            };
                        }
                    } else {
                        if (!table[rowIndex][colIndex]) {
                            table[rowIndex][colIndex] = {
                                content: cellContent,
                                rowspan: rowspan,
                                colspan: colspan,
                                merged: false,
                                alignCenter,
                                isHeader
                            };
                        }
                    }
                });
            });

            table.forEach(row => {
                html += "  <tr>\n";
                row.forEach(cell => {
                    if (cell && !cell.merged) {
                        let tag = cell.isHeader ? 'th' : 'td';
                        let style = cell.alignCenter ? ' style="text-align: center;"' : '';
                        html += `    <${tag}${style}${cell.rowspan > 1 ? ` rowspan="${cell.rowspan}"` : ""}${cell.colspan > 1 ? ` colspan="${cell.colspan}"` : ""}>${convertMarkdownToHtml(cell.content)}</${tag}>\n`;
                    }
                });
                html += "  </tr>\n";
            });

            html += "</table>\n\n";
            html += "<p><br></p>";

            // Reverte os valores temporários para ";"
            html = html.replace(/__ESCAPED_SEMICOLON__/g, ";");

            return html;
        }

    </script>
<!-- versão 1.0 -->
</body>
</html>